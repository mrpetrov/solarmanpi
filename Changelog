2.5 2015-04-19
Changed how electrical power used gets handled by solard - now we have two
separate float variables TotalPowerUsed and NightlyPowerUsed which get updated
at every call to ActivateHeatingMode() accordingly. Night tariff is hard-coded
to between 23:00 and 06:59. The constants HEATERPPC, PUMPPPC, VAVLEPPC and
SELFPPC have the watt-hour electrical power used for 10 seconds of operation
for the electrical heater, pumps, valve and the Pi system itself.
The human readable data log file is renamed to "/run/shm/solard_data.log". It
now shows both power meters.
The array ctrlstatecycles[] is back to 5 cells.
BoilerHeating() adjusted to trigger if temperature Wanted > Previous > Current,
if there is less than 0.3 C to the temp wanted. Also, it wont trigger if the
colder end of the boiler is as hot as temp wanted.
Electrical heater minimum off time is now 2 minutes.

2.4 2015-04-18
solard now records the electrical power used since started. This is done by
growing ctrlstatecycles[] array to 6 cells where the sixth one is being used
to store the number of 10 seconds cycles with electric power on. Actual power
used in watts per 10 seconds is hard-coded to 8.34 W for 3 kW electrical heater
in the constant POWERPERCYCLE - adjust it according to your actual heater power.
LogData() was optimized to write data including new usage counter to the log
file in one go instead of open, write, close for each of the 11 written data
tokens. Also, the human-readable CSV file now shows watts used.
Restarting the collectd daemon is needed, so a new RRD file can be created.

2.3 2015-04-16
Fixed "emergency heat transfer" to actually do its thing - it was b0rken and
now it will work as intended, plus there is less code now.
Moved the max temp difference allowed between reads to a separate #define.
Fixed furnace pump periodic turn on to actually trigger every 7 days.
Solar pump is turned on every 4 hours between 05:00 and 0:00 - this should
keep the vacuum tubes of the solar panel filled with water during the hot
days. NOTE May need extra attention when the panel get installed later.
Lowered the temp difference required to use the solar panel to heat up the
house to 10 C in mode=2.
Changed BoilerHeatingNeeded() to trigger only if current AND previous boiler
hot end temps are both lower than the temp wanted.
Removed the _Prev cells from controls[] array for both pumps, valve and heater
- they were not used anywhere, anyway...

2.2 2015-04-15
Completely rewritten mode selection code - its now bit based, and much easier
to read.
Introduced 2 new manual modes: mode=4 turns on pump 1 only and mode=5 turns
on pump 2 only.
Fixed a few typos. Disabled the pumps toggling on switch to battery power -
this needs monitoring to see how the pumps fare without proper power
management.
Electric heater now has a minimum OFF time of 1 minute before being allowed
to be turned back on.
Adjusted idle mode pump control: if furnace is hot (> 44 C) - even slight
increase in temp will turn pump on; if furnace is warm (> 38 C) - there needs
to be a ~0.12 C increase to trigger pump on; and last - if furnace is cold, but
warming quickly, e.i. > 24 C but increasing by ~0.24 C per 10 seconds - the
pump will be turned on.
Allow temp changes of maximum 4 C - the previous change to 3 C max was not
sufficient after all...

2.1
Furnace is being protected from freezing if its less than 9 C now.
Changed is the idle mode pump control: now there are 3 stages; if furnace is
hot (> 46 C) - even slight increase in temp will turn pump on; if furnace is
warm (> 38 C) - there needs to be a 0.1 C increase to trigger pump on; and
last - if furnace is cold, but warming quickly, e.i. > 24 C but increasing
by 0.5 C per 10 seconds - the pump will be turned on. That way, we move
mostly hot water in the house heating system, and protect the furnace from
severe heating shocks.

2.0
Fix some printed texts and allow temp changes of maximum 3 C - it turns out
that 2 C is too small for 10 seconds at times, so allow for a bit more.

1.9
ReadSensors() now makes corrections upon too wild data of max 2 C. It also
is a lot more informative for the corrections in the log file.
Changed the diff required between furnace temp and boiler to 1.5 C to use as
a heat source.
Critical temps changes: max boiler t=70, max furnace t=77, max solar temp=88

1.8 2015-04-11
Fixed some typos. Added _Prev vars for temperature sensor readings and the
controls[] array. The controls[] array also got a new ctrlstatecycles[5]
array which will count the 10 second cycles spent in the last state; zeroed
upon change of state. Added sensible init values to said arrays.
Tweaked ReadSensors() to log a warning when it hits trouble, and to
deal nicely with too wild changes to sensor data, i.e. it now makes
changes no bigger than 3 degrees C, and logs when it corrects data. It only
takes raw data in upon startup - there is a var just_started to allow this.
Changed the format of the data in solar_data.csv - now its easier to read,
and it also contains the used HeatingMode/IdleMode.
Critical temps changes: max boiler t=77, max solar temp=90

1.7 2015-04-10
Don't bother turning the solar pump on for now - it is absent anyway.
New config mode introduced:
mode=3
forces only furnace pump ON.
Changed temp diff requirements: solar comes on if at least 8 degrees C hotter,
was 5 C; furnace now needs 5 C more than boiler, was 3 C. And all boiler
comparisons now use the hotter sensor, which sadly is placed too low, but for
now will have to do.
So, currently the system practically controls boiler valve opening and logs
the temps.

EOF
